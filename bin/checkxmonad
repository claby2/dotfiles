#!/bin/sh
# Compile xmonad with warnings without producing clutter (*.o, *.hi, and binary file).
# The purpose of this script is to verify if the current xmonad configuration compiles without warnings.

progress() {
	echo "\033[1;34m::\033[1;37m $1 \033[0m"
}

check() {
	# shellcheck disable=SC2086
	progress "Compiling..." &&
		cd ~/.xmonad &&
		stack ghc -- -Wall -Werror \
			-fwarn-tabs -funbox-strict-fields \
			-fforce-recomp \
			-no-keep-o-files -no-keep-hi-files \
			$1 -o /dev/null &&
		progress "Running hlint..." &&
		hlint --cross $1 &&
		progress "Success!"
}

# Recursively finds *.hs files in xmonad directory.
files=$(find ~/.xmonad/src ~/.xmonad/app -type f -name "*.hs")

while getopts "f" opt; do
	case "$opt" in
	f)
		# Output haskell files in xmonad directory.
		echo "$files"
		exit 0
		;;
	*)
		exit 1
		;;
	esac
done

check "$files"
